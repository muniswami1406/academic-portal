<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Portal | Muniswami</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Inter', sans-serif; background: #f0f4f8; padding: 20px; }
        .hidden { display: none !important; }

        /* Login UI */
        #login-screen { max-width: 350px; margin: 100px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .login-btn { width: 100%; padding: 12px; background: #1e88e5; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Portal UI */
        .container { max-width: 850px; margin: 0 auto; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { background: #1e88e5; color: white; padding: 30px; text-align: center; position: relative; }
        .signout-btn { position: absolute; right: 20px; top: 20px; background: #d32f2f; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 11px; }
        
        .content { padding: 25px; }

        /* Payment Sections */
        .payment-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .pay-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; margin-top: 10px; }
        .pay-link { padding: 10px; border-radius: 6px; text-align: center; color: white; text-decoration: none; font-weight: 600; font-size: 11px; }
        .p1 { background: #ffa726; } .p2 { background: #43a047; } .p3 { background: #26c6da; } .p4 { background: #5c6bc0; }

        /* Receipt Sections */
        .year-header { font-size: 16px; font-weight: 700; color: #0d47a1; margin: 25px 0 10px 0; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #e3f2fd; padding-bottom: 5px; }
        .receipt-item { background: #f8fafc; border: 1px solid #e0e6ed; padding: 10px 15px; border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Modal */
        #upload-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index: 1000; }
        .modal-box { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; }
        select, .modal-box input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; }

        iframe { width: 100%; height: 450px; border-radius: 10px; margin-top: 25px; border: 1px solid #ddd; }
        .footer { text-align: right; font-size: 12px; color: #888; margin-top: 20px; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="color:#1e88e5; margin-bottom:15px;">Admin Login</h2>
    <input type="text" id="user" class="login-input" placeholder="Username">
    <input type="password" id="pass" class="login-input" placeholder="Password">
    <button class="login-btn" onclick="checkLogin()">Login</button>
    <p id="err" style="color:red; font-size:12px; margin-top:10px;"></p>
</div>

<div id="main-portal" class="hidden">
    <div class="container">
        <div class="header">
            <button class="signout-btn" onclick="location.reload()">Sign Out</button>
            <h1>Academic Portal</h1>
            <p>Annamacharya University</p>
        </div>

        <div class="content">
            <h3 style="color:#0d47a1; margin-bottom: 15px;">üí≥ Fast Payment Links</h3>
            <div id="payment-area"></div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                <h3 style="color:#0d47a1;">üìÇ My Saved Receipts</h3>
                <button class="login-btn" style="width: auto; padding: 8px 15px; background: #43a047;" onclick="toggleModal(true)">+ Upload New</button>
            </div>
            <div id="receipts-area"></div>

            <h3 class="year-header" style="margin-top:40px;">üìã Exam Results</h3>
            <iframe src="https://aits.campx.in/aitspu/ums/results"></iframe>
            <div class="footer">Developed by Muniswami.y‚ù§Ô∏è</div>
        </div>
    </div>
</div>

<div id="upload-modal" class="hidden">
    <div class="modal-box">
        <h3>Save Receipt</h3>
        <select id="m-year">
            <option value="year1">1st Year</option><option value="year2">2nd Year</option>
            <option value="year3">3rd Year</option><option value="year4">4th Year</option>
        </select>
        <input type="text" id="m-fee" placeholder="Fee Type (Tuition/Skill)">
        <input type="text" id="m-name" placeholder="File Name">
        <input type="text" id="m-link" placeholder="Drive Link">
        <button class="login-btn" onclick="saveData()">Save</button>
        <button class="login-btn" style="background:#666; margin-top:5px;" onclick="toggleModal(false)">Cancel</button>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDCbW11uH6UvnJTJLOV-dNQiXQ_w1gFRN0",
      authDomain: "academic-portal-b1122.firebaseapp.com",
      projectId: "academic-portal-b1122",
      storageBucket: "academic-portal-b1122.firebasestorage.app",
      messagingSenderId: "904116478398",
      appId: "1:904116478398:web:3dadab2b045229418d59ef"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const payData = {
        2: [{n:"Tuition Partial", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/2/payment/group/2"}, {n:"Tuition Full", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/full-pay/2/payment/group/2"}],
        3: [{n:"Tuition Partial", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/3/payment/group/2"}, {n:"Tuition Full", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/full-pay/3/payment/group/2"}, {n:"Skill Partial", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/3/payment/group/1"}, {n:"Skill Full", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/full-pay/3/payment/group/1"}],
        4: [{n:"Tuition Partial", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/4/payment/group/2"}, {n:"Tuition Full", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/full-pay/4/payment/group/2"}, {n:"Skill Partial", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/4/payment/group/1"}, {n:"Skill Full", u:"https://aits.campx.in/aitspu/payments/public/academic-fees/details/full-pay/4/payment/group/1"}]
    };

    function checkLogin() {
        if(document.getElementById('user').value === "Muniswami" && document.getElementById('pass').value === "1406") {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-portal').classList.remove('hidden');
            renderPayments();
            loadData();
        } else { document.getElementById('err').innerText = "Wrong!"; }
    }

    function renderPayments() {
        const area = document.getElementById('payment-area');
        area.innerHTML = '';
        [2,3,4].forEach(y => {
            let btns = payData[y].map((l,i) => `<a href="${l.u}" target="_blank" class="pay-link p${i+1}">${l.n}</a>`).join('');
            area.innerHTML += `<div class="payment-card"><b>${y} Year Payments</b><div class="pay-grid">${btns}</div></div>`;
        });
    }

    function toggleModal(s) { document.getElementById('upload-modal').classList.toggle('hidden', !s); }

    async function saveData() {
        const year = document.getElementById('m-year').value;
        const fee = document.getElementById('m-fee').value;
        const name = document.getElementById('m-name').value;
        const link = document.getElementById('m-link').value;
        if(!fee || !name || !link) return alert("Fill all!");
        await db.collection("receipt_links").add({ year, feeType: fee, displayName: name, url: link, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        toggleModal(false);
        loadData();
    }

    async function loadData() {
        const area = document.getElementById('receipts-area');
        const snap = await db.collection("receipt_links").orderBy("createdAt", "desc").get();
        const groups = { year1:[], year2:[], year3:[], year4:[] };
        snap.forEach(doc => { const d = doc.data(); groups[d.year || 'year1'].push({id: doc.id, ...d}); });
        
        area.innerHTML = '';
        const names = { year1:"1st Year", year2:"2nd Year", year3:"3rd Year", year4:"4th Year" };
        for(let k in groups) {
            if(groups[k].length > 0) {
                let html = `<div class="year-header">üìÇ ${names[k]}</div>`;
                groups[k].forEach(item => {
                    html += `<div class="receipt-item"><div><b>${item.feeType}</b><br><small>${item.displayName}</small></div>
                    <div style="display:flex; gap:5px;"><a href="${item.url}" target="_blank" class="v-btn" style="text-decoration:none;">View</a>
                    <button class="d-btn" onclick="deleteData('${item.id}')">Delete</button></div></div>`;
                });
                area.innerHTML += html;
            }
        }
    }

    async function deleteData(id) { if(confirm("Delete?")) { await db.collection("receipt_links").doc(id).delete(); loadData(); } }
</script>
</body>
</html>
